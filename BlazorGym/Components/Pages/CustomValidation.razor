@page "/custom-validation"

<PageTitle>Home</PageTitle>

<h3>Custom Validation With EditContext</h3>

<EditForm FormName="member-form" OnValidSubmit="Submit" EditContext="@editContext">

    <DataAnnotationsValidator />

    <ValidationSummary />

    <div class="form-group row mb-3">
        <label class="col-sm-3 col-form-label" for="Name">Name:</label>
        <div class="col-sm-9">
            <InputText class="form-control" @bind-Value="Member.Name" />
            <ValidationMessage For="@(() => Member.Name)" />
        </div>
    </div>

    <div class="form-group row mb-3">
        <label class="col-sm-3 col-form-label" for="Email">Email:</label>
        <div class="col-sm-9">
            <InputText type="email" class="form-control" formnovalidate @bind-Value="Member.Email" />
            <ValidationMessage For="@(() => Member.Email)" />
        </div>
    </div>

    <div class="form-group row mb-3">
        <label class="col-sm-3 col-form-label" for="Password">Password:</label>
        <div class="col-sm-9">
            <InputText type="password" class="form-control" @bind-Value="Member.Password" />
            <ValidationMessage For="@(() => Member.Password)" />
        </div>
    </div>

    <div class="form-group row mb-3">
        <label class="col-sm-3 col-form-label" for="Message">Message:</label>
        <div class="col-sm-9">
            <InputTextArea class="form-control" @bind-Value="Member.Message" />
            <ValidationMessage For="@(() => Member.Message)" />
        </div>
    </div>

    <div class="form-group row mb-3">
        <label class="col-sm-3 col-form-label" for="Country">Country:</label>
        <div class="col-sm-9">
            <InputSelect class="form-control" @bind-Value="Member.Country">
                @foreach (var country in Countries.All)
                {
                    <option value="@country.Key">@country.Value</option>
                }
            </InputSelect>
        </div>
    </div>

    <div class="form-group row mb-3">
        <label class="col-sm-3 col-form-label" for="Subscriber">Subscribe:</label>
        <div class="col-sm-9">
            <InputCheckbox class="form-check-input" @bind-Value="Member.Subscriber" />
        </div>
    </div>

    <div class="form-group row mb-3">
        <label class="col-sm-3 col-form-label" for="Gender">Gender:</label>
        <div class="col-sm-9">
            <InputRadioGroup Name="Gender" @bind-Value="Member.Gender">
                @foreach (Gender gender in Enum.GetValues<Gender>())
                {
                    <InputRadio class="form-check-input" Name="Gender" Value="@gender" />
                    <label class="form-check-label">@gender</label>
                }
            </InputRadioGroup>
        </div>
    </div>

    <div class="form-group mb-3">
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>
</EditForm>

<p>@Member.ToJson()</p>

@code {
    private Member Member { get; set; } = new Member
    {
        Name = string.Empty,
        Email = "ecr@live.dk",
        Password = string.Empty,
        Country = "be",
        Message = "I ❤ Blazor!",
        Gender = Gender.Male,
        Subscriber = true
    };

    private EditContext? editContext;
    private ValidationMessageStore? messageStore;

    protected override void OnInitialized()
    {
        editContext = new(Member); // Member has already been set
        editContext.OnValidationRequested += HandleValidationRequested;
        messageStore = new(editContext);
    }

    private void HandleValidationRequested(object? sender, ValidationRequestedEventArgs e)
    {
        messageStore?.Clear();
        if (Member.Name is not string { Length: > 1 })
        {
            messageStore?.Add(() => Member.Name, "Name is mandatory");
        }
        else if (Member.Name is not string { Length: < 10 })
        {
            messageStore?.Add(() => Member.Name, "Name cannot be longer that 10 characters");
        }
    }

    public void Submit()
    {
        Console.WriteLine(Member.ToJson());
    }
}